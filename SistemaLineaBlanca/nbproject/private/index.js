var url,request,cortanaPlat,host,tag="proxy/index.js",headersToDelete=["cache-control","expires"];exports.addToRouter=function(a){console.log("%s: adding all remaining pages to proxy route",tag);a.add(["get","post"],"*",function(a,f,e){url=url||require("url");request=request||require("request");cortanaPlat=cortanaPlat||require("cortana-platform");delete a.headers.host;var b=url.parse(a.url);console.log("%s: [%d] proxying request to server",tag,a.__reqId);host=host||cortanaPlat.config.getLocaleEndpoint("Host","www.bing.com");b.host=host;b.protocol="https";var d={uri:url.format(b),method:a.method,headers:a.headers,useCache:true},c=request(d);c.on("error",function(b){console.error("%s: [%d] proxy request failed, error: %s",tag,a.__reqId,b);e()});c.on("response",function(a){a.headers&&headersToDelete.forEach(function(b){delete a.headers[b]})});a.pipe(c).pipe(f)})}